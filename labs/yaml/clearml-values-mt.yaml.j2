# Rendered by Jinja2 before Helm. NEVER commit the rendered file with secrets.
# Ingress / hostnames

imageCredentials:
  password: "{{ CLEAML_DKR_TKN }}"

clearml:
  cookieDomain: "live.charlie.alta3.com"

clearmlApplications:
  enabled: true
apiserver:
  service: { type: ClusterIP }
  ingress:
    enabled: true
    ingressClassName: nginx
    hostName: "{{ APIURL | default('api-' ~ CLUSTER_ID ~ '.live.charlie.alta3.com') }}"
    annotations:
      nginx.ingress.kubernetes.io/proxy-body-size: "0"
      nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
      nginx.ingress.kubernetes.io/proxy-send-timeout: "600"

  # --- BEGIN: Multi-Tenant Feature Flags ---
  extraEnvs:
  - name: CLEARML__services__organization__features__user_management_advanced
    value: "true"
  - name: CLEARML__apiserver__company__unique_names
    value: "true"
  - name: CLEARML__services__workers__resource_usages__supervisor_company
    value: "{{ LICENSE_USERNAME }}"
  # System-scoped supervisor identity (Service User, NOT a human login)
  - name: CLEARML__secure__credentials__supervisor__role
    value: "system"
  - name: CLEARML__secure__credentials__supervisor__sec_groups
    value: "[\"users\", \"admins\", \"queue_admins\"]"
  - name: CLEARML__secure__credentials__supervisor__user_key
    valueFrom:
      secretKeyRef: { name: clearml-supervisor-credentials, key: user_key }
  - name: CLEARML__secure__credentials__supervisor__user_secret
    valueFrom:
      secretKeyRef: { name: clearml-supervisor-credentials, key: user_secret }
  # --- END: Multi-Tenant Feature Flags ---

  # ClearML Requires either fixed users or an SSO (Identity Provider) configuration.
  additionalConfigs:
    apiserver.conf: |
      auth {
        fixed_users {
          enabled: true
          pass_hashed: false
          users: [
            {
              username: "Student"
              password: "alta3"
              name: "Alta3 Student"
              admin: true
            },
          ]
        }
      }

webserver:
  service: { type: ClusterIP }
  ingress:
    enabled: true
    ingressClassName: nginx
    hostName: "{{ APPURL | default('app-' ~ CLUSTER_ID ~ '.live.charlie.alta3.com') }}"
    annotations:
      nginx.ingress.kubernetes.io/proxy-body-size: "0"
      nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
      nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
  # (keep your existing service/ingress keys)
  extraEnv:
    - name: CLEARML__enterprise__multi_tenant
      value: "true"

fileserver:
  service: { type: ClusterIP }
  ingress:
    enabled: true
    ingressClassName: nginx
    hostName: "{{ FILESURL | default('files-' ~ CLUSTER_ID ~ '.live.charlie.alta3.com') }}"
    annotations:
      nginx.ingress.kubernetes.io/proxy-body-size: "0"
      nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
      nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
  persistence:
    enabled: true
    storageClass: nfs-csi
    size: 50Gi

# Persistence: uses your NFS-CSI default SC
mongodb:
  enabled: true
  architecture: replicaset
  persistence:
    enabled: true
    storageClass: nfs-csi
    size: 20Gi

elasticsearch:
  enabled: true
  master:
    persistence:
      enabled: true
      storageClass: nfs-csi
      size: 50Gi
  data:
    persistence:
      enabled: true
      storageClass: nfs-csi
      size: 100Gi

redis:
  master:
    persistence:
      enabled: true
      storageClass: nfs-csi
